-- å•†åº—ç³»ç»Ÿå…±äº«æ•°æ®ç»“æ„

local ShopData = {}

-- ç‰©å“æ•°æ®ç»“æ„
export type Item = {
    id: string,
    name: string,
    price: number,
    maxQuantity: number?, -- nilè¡¨ç¤ºæ— é™
    description: string?,
    icon: string?,
    imageId: string?, -- å•†å“å›¾ç‰‡ID
    category: string?, -- å•†å“åˆ†ç±»
    sellPrice: number? -- å–å‡ºä»·æ ¼ï¼Œå¦‚æœnilåˆ™è‡ªåŠ¨è®¡ç®—ä¸ºåŸä»·80%
}

-- ç©å®¶ç‰©å“æ•°æ®ç»“æ„
export type PlayerItem = {
    itemId: string,
    quantity: number
}

-- ç©å®¶æ•°æ®
export type PlayerData = {
    coins: number,
    items: {[string]: PlayerItem}
}

-- å•†åº—é…ç½®
local SHOP_ITEMS: {[string]: Item} = {
    ["sword"] = {
        id = "sword",
        name = "é“å‰‘",
        price = 100,
        maxQuantity = 10,
        description = "ä¸€æŠŠé”‹åˆ©çš„é“å‰‘ï¼Œå¢åŠ æ”»å‡»åŠ›",
        icon = "âš”ï¸",
        imageId = "rbxassetid://6031075938", -- å‰‘çš„å›¾ç‰‡
        category = "æ­¦å™¨",
        sellPrice = 80
    },
    ["potion"] = {
        id = "potion",
        name = "ç”Ÿå‘½è¯æ°´",
        price = 50,
        maxQuantity = nil, -- æ— é™
        description = "æ¢å¤50ç‚¹ç”Ÿå‘½å€¼çš„ç¥å¥‡è¯æ°´",
        icon = "ğŸ§ª",
        imageId = "rbxassetid://6031068421", -- è¯æ°´å›¾ç‰‡
        category = "æ¶ˆè€—å“",
        sellPrice = 40
    },
    ["shield"] = {
        id = "shield",
        name = "æœ¨ç›¾",
        price = 80,
        maxQuantity = 15,
        description = "æä¾›åŸºç¡€é˜²å¾¡çš„æœ¨åˆ¶ç›¾ç‰Œ",
        icon = "ğŸ›¡ï¸",
        imageId = "rbxassetid://6031068421", -- ç›¾ç‰Œå›¾ç‰‡
        category = "é˜²å…·",
        sellPrice = 64
    },
    ["gem"] = {
        id = "gem",
        name = "é­”æ³•å®çŸ³",
        price = 200,
        maxQuantity = 5,
        description = "è•´å«å¼ºå¤§é­”åŠ›çš„ç¥ç§˜å®çŸ³",
        icon = "ğŸ’",
        imageId = "rbxassetid://6031068421", -- å®çŸ³å›¾ç‰‡
        category = "é­”æ³•",
        sellPrice = 160
    },
    ["armor"] = {
        id = "armor",
        name = "çš®é©æŠ¤ç”²",
        price = 150,
        maxQuantity = 8,
        description = "è½»ä¾¿ä½†æœ‰æ•ˆçš„çš®é©æŠ¤ç”²",
        icon = "ğŸ¥¼",
        imageId = "rbxassetid://6031068421", -- æŠ¤ç”²å›¾ç‰‡
        category = "é˜²å…·",
        sellPrice = 120
    },
    ["bow"] = {
        id = "bow",
        name = "é•¿å¼“",
        price = 120,
        maxQuantity = 12,
        description = "ç²¾å‡†çš„è¿œç¨‹æ­¦å™¨",
        icon = "ğŸ¹",
        imageId = "rbxassetid://6031068421", -- å¼“ç®­å›¾ç‰‡
        category = "æ­¦å™¨",
        sellPrice = 96
    },
    ["scroll"] = {
        id = "scroll",
        name = "é­”æ³•å·è½´",
        price = 75,
        maxQuantity = nil, -- æ— é™
        description = "è®°å½•ç€å¤è€å’’è¯­çš„å·è½´",
        icon = "ğŸ“œ",
        imageId = "rbxassetid://6031068421", -- å·è½´å›¾ç‰‡
        category = "é­”æ³•",
        sellPrice = 60
    },
    ["food"] = {
        id = "food",
        name = "é¢åŒ…",
        price = 25,
        maxQuantity = nil, -- æ— é™
        description = "ç¾å‘³çš„é¢åŒ…ï¼Œæ¢å¤å°‘é‡ç”Ÿå‘½å€¼",
        icon = "ğŸ",
        imageId = "rbxassetid://6031068421", -- é¢åŒ…å›¾ç‰‡
        category = "æ¶ˆè€—å“",
        sellPrice = 20
    }
}

-- è·å–å•†åº—ç‰©å“
function ShopData.getShopItems(): {[string]: Item}
    return SHOP_ITEMS
end

-- è·å–ç‰¹å®šç‰©å“
function ShopData.getItem(itemId: string): Item?
    return SHOP_ITEMS[itemId]
end

-- åˆ›å»ºé»˜è®¤ç©å®¶æ•°æ®
function ShopData.createDefaultPlayerData(): PlayerData
    return {
        coins = 3000, -- åˆå§‹é‡‘å¸
        items = {}
    }
end

-- è®¡ç®—å–å‡ºä»·æ ¼ï¼ˆåŸä»·çš„80%ï¼‰
function ShopData.calculateSellPrice(price: number): number
    return math.floor(price * 0.8)
end

-- è·å–æŒ‡å®šåˆ†ç±»çš„ç‰©å“
function ShopData.getItemsByCategory(category: string): {[string]: Item}
    local result = {}
    for itemId, item in pairs(SHOP_ITEMS) do
        if item.category == category then
            result[itemId] = item
        end
    end
    return result
end

-- è·å–æ‰€æœ‰åˆ†ç±»
function ShopData.getCategories(): {string}
    local categories = {}
    local seen = {}
    for _, item in pairs(SHOP_ITEMS) do
        if item.category and not seen[item.category] then
            table.insert(categories, item.category)
            seen[item.category] = true
        end
    end
    return categories
end

-- è·å–ç‰©å“çš„å®é™…å–å‡ºä»·æ ¼
function ShopData.getActualSellPrice(item: Item): number
    return item.sellPrice or ShopData.calculateSellPrice(item.price)
end

-- å¯¼å‡º SHOP_ITEMS ä¾›ç›´æ¥è®¿é—®
ShopData.SHOP_ITEMS = SHOP_ITEMS

return ShopData
