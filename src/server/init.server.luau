-- å•†åº—ç³»ç»ŸæœåŠ¡ç«¯ä¸»å¯åŠ¨è„šæœ¬
-- è¿™æ˜¯Robloxè‡ªåŠ¨æ‰§è¡Œçš„ä¸»æœåŠ¡ç«¯è„šæœ¬

print("ğŸš€ [æœåŠ¡ç«¯] å•†åº—ç³»ç»Ÿæ­£åœ¨å¯åŠ¨...")

-- ç¬¬ä¸€æ­¥ï¼šå¯åŠ¨DataStoreæœåŠ¡ï¼ˆé¡¶çº§æ•°æ®æœåŠ¡ï¼‰
print("ğŸ“¦ å¯åŠ¨DataStoreæœåŠ¡...")

-- è·å–DataStoreç®¡ç†å™¨æ¨¡å—
local function getDataStoreManager()
    local ServerScriptService = game:GetService("ServerScriptService")
    local serverFolder = ServerScriptService:FindFirstChild("Server")
    if serverFolder then
        local datastoreFolder = serverFolder:FindFirstChild("datastoreservice")
        if datastoreFolder and datastoreFolder:FindFirstChild("DataStoreManager") then
            return require(datastoreFolder.DataStoreManager)
        end
    end
    error("âŒ æ— æ³•æ‰¾åˆ°DataStoreç®¡ç†å™¨æ¨¡å—")
end

local DataStoreManager = getDataStoreManager()

-- ç¬¬äºŒæ­¥ï¼šè®¾ç½®å…±äº«æ¨¡å—
local setupScript = nil

-- ä»utilsæ–‡ä»¶å¤¹è·å–SetupReplicatedStorage
local success, result = pcall(function()
    local ServerScriptService = game:GetService("ServerScriptService")
    local serverFolder = ServerScriptService:FindFirstChild("Server")
    if serverFolder then
        local srcFolder = serverFolder.Parent
        local utilsFolder = srcFolder:FindFirstChild("utils")
        if utilsFolder and utilsFolder:FindFirstChild("SetupReplicatedStorage") then
            return utilsFolder.SetupReplicatedStorage
        end
    end
    return nil
end)

if success and result then
    setupScript = result
    require(setupScript)
    print("âœ… å…±äº«æ¨¡å—è®¾ç½®å®Œæˆ")
else
    warn("âš ï¸ æ‰¾ä¸åˆ°SetupReplicatedStorageè„šæœ¬")
end

-- ç­‰å¾…ä¸€å¸§ï¼Œç¡®ä¿æ¨¡å—å·²åˆ›å»º
game:GetService("RunService").Heartbeat:Wait()

-- ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨ä¸šåŠ¡æœåŠ¡
print("ğŸ”§ å¯åŠ¨ä¸šåŠ¡æœåŠ¡...")

-- è·å–æœåŠ¡æ¨¡å—çš„è¾…åŠ©å‡½æ•°
local function getServiceModule(serviceName)
    local ServerScriptService = game:GetService("ServerScriptService")
    local serverFolder = ServerScriptService:FindFirstChild("Server")
    if serverFolder then
        local servicesFolder = serverFolder:FindFirstChild("services")
        if servicesFolder and servicesFolder:FindFirstChild(serviceName) then
            return require(servicesFolder[serviceName])
        end
    end
    error("âŒ æ— æ³•æ‰¾åˆ°æœåŠ¡æ¨¡å—: " .. serviceName)
end

local services = {
    AdminService = getServiceModule("AdminService"),
    CacheService = getServiceModule("CacheService"),
    DataService = getServiceModule("DataService"),
    DroneService = getServiceModule("DroneService"),
    UserService = getServiceModule("UserService"),
    TargetService = getServiceModule("TargetService")
}

-- ç¬¬å››æ­¥ï¼šå¯åŠ¨åŠŸèƒ½æ¨¡å—
print("âš™ï¸ å¯åŠ¨åŠŸèƒ½æ¨¡å—...")

-- è·å–Bootstrapæ¨¡å—
local function getBootstrap()
    local ServerScriptService = game:GetService("ServerScriptService")
    local serverFolder = ServerScriptService:FindFirstChild("Server")
    if serverFolder then
        local functionsFolder = serverFolder:FindFirstChild("functions")
        if functionsFolder and functionsFolder:FindFirstChild("Bootstrap") then
            return require(functionsFolder.Bootstrap)
        end
    end
    error("âŒ æ— æ³•æ‰¾åˆ°Bootstrapæ¨¡å—")
end

local Bootstrap = getBootstrap()

-- åˆå§‹åŒ–é¶å­ç³»ç»Ÿ
if services.TargetService and services.TargetService.initialize then
    services.TargetService.initialize()
    print("ğŸ¯ é¶å­ç³»ç»Ÿå·²åˆå§‹åŒ–")
else
    warn("âš ï¸ TargetService æœªæ‰¾åˆ°æˆ–ç¼ºå°‘ initialize æ–¹æ³•")
end

print("âœ… [æœåŠ¡ç«¯] å•†åº—ç³»ç»Ÿå·²å®Œå…¨å¯åŠ¨")
