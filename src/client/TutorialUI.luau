-- å¼•å¯¼æ•™ç¨‹UIæ¨¡å—

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local TutorialUI = {}

-- ç§æœ‰å˜é‡
local tutorialGui = nil
local isShowing = false
local currentStep = 1

-- æ•™ç¨‹æ­¥éª¤æ•°æ®
local tutorialSteps = {
    {
        title = "ğŸ‰ æ¬¢è¿æ¥åˆ°å•†åº—ç³»ç»Ÿï¼",
        content = "è¿™æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„å•†åº—ç³»ç»Ÿï¼ŒåŒ…å«8ç§ç²¾ç¾å•†å“ã€‚\n\nâ€¢ æ”¯æŒä¹°å–ç‰©å“\nâ€¢ å®æ—¶é‡‘å¸ç³»ç»Ÿ\nâ€¢ äº¤æ˜“è®°å½•æŸ¥çœ‹\n\nè®©æˆ‘ä»¬å¼€å§‹æ•™ç¨‹å§ï¼",
        buttonText = "å¼€å§‹æ•™ç¨‹"
    },
    {
        title = "ğŸ’° é‡‘å¸ç³»ç»Ÿ",
        content = "ä½ å¼€å§‹æ—¶æœ‰ 3000 é‡‘å¸ã€‚\n\nâ€¢ è´­ä¹°ç‰©å“éœ€è¦æ¶ˆè€—é‡‘å¸\nâ€¢ å‡ºå”®ç‰©å“å¯è·å¾—é‡‘å¸\nâ€¢ é‡‘å¸ä½™é¢å®æ—¶æ˜¾ç¤ºåœ¨ç•Œé¢é¡¶éƒ¨",
        buttonText = "äº†è§£æ›´å¤š"
    },
    {
        title = "ğŸ›ï¸ æ‰“å¼€å•†åº—",
        content = "æŒ‰ **E** é”®å¯ä»¥æ‰“å¼€å•†åº—ç•Œé¢ã€‚\n\nâ€¢ å•†åº—æœ‰ä¸‰ä¸ªæ ‡ç­¾é¡µï¼šè´­ä¹°ã€å‡ºå”®ã€è®°å½•\nâ€¢ æŒ‰ **ESC** é”®å¯ä»¥å…³é—­ç•Œé¢\nâ€¢ æŒ‰ **H** é”®å¯ä»¥æŸ¥çœ‹å¸®åŠ©",
        buttonText = "æ˜ç™½äº†"
    },
    {
        title = "ğŸ›’ è´­ä¹°ç‰©å“",
        content = "åœ¨ã€Œè´­ä¹°ã€æ ‡ç­¾é¡µä¸­ï¼š\n\nâ€¢ æµè§ˆ8ç§ç²¾ç¾å•†å“\nâ€¢ æŸ¥çœ‹ä»·æ ¼å’Œåº“å­˜ä¿¡æ¯\nâ€¢ ç‚¹å‡»ã€Œè´­ä¹°ã€é€‰æ‹©æ•°é‡\nâ€¢ ç¡®è®¤è´­ä¹°å®Œæˆäº¤æ˜“",
        buttonText = "ç»§ç»­"
    },
    {
        title = "ğŸ’¸ å‡ºå”®ç‰©å“",
        content = "åœ¨ã€Œå‡ºå”®ã€æ ‡ç­¾é¡µä¸­ï¼š\n\nâ€¢ æŸ¥çœ‹ä½ æ‹¥æœ‰çš„æ‰€æœ‰ç‰©å“\nâ€¢ å‡ºå”®ä»·æ ¼æ˜¯åŸä»·çš„80%\nâ€¢ é€‰æ‹©å‡ºå”®æ•°é‡è·å¾—é‡‘å¸\nâ€¢ æ”¯æŒæ‰¹é‡å‡ºå”®æ“ä½œ",
        buttonText = "ä¸‹ä¸€æ­¥"
    },
    {
        title = "ğŸ“Š äº¤æ˜“è®°å½•",
        content = "åœ¨ã€Œè®°å½•ã€æ ‡ç­¾é¡µä¸­ï¼š\n\nâ€¢ æŸ¥çœ‹æ‰€æœ‰è´­ä¹°å’Œå‡ºå”®å†å²\nâ€¢ æ˜¾ç¤ºäº¤æ˜“æ—¶é—´å’Œé‡‘é¢\nâ€¢ ç®¡ç†å‘˜å¯æŸ¥çœ‹å…¨æœæ•°æ®\nâ€¢ è®°å½•æ°¸ä¹…ä¿å­˜",
        buttonText = "äº†è§£äº†"
    },
    {
        title = "ğŸ® å¼€å§‹æ¸¸æˆ",
        content = "æ•™ç¨‹å®Œæˆï¼ç°åœ¨ä½ å·²ç»æŒæ¡äº†ï¼š\n\nâœ… å¦‚ä½•æ‰“å¼€å•†åº— (Eé”®)\nâœ… å¦‚ä½•è´­ä¹°å’Œå‡ºå”®ç‰©å“\nâœ… å¦‚ä½•æŸ¥çœ‹äº¤æ˜“è®°å½•\nâœ… å¦‚ä½•è·å–å¸®åŠ© (Hé”®)\n\nç¥ä½ æ¸¸æˆæ„‰å¿«ï¼",
        buttonText = "å¼€å§‹æ¸¸æˆ"
    }
}

-- åˆ›å»ºæ•™ç¨‹UI
local function createTutorialGUI()
    if tutorialGui then
        tutorialGui:Destroy()
    end

    -- ä¸»GUI
    tutorialGui = Instance.new("ScreenGui")
    tutorialGui.Name = "TutorialGUI"
    tutorialGui.ResetOnSpawn = false
    tutorialGui.IgnoreGuiInset = true -- ä¸é®ç›–æ ¸å¿ƒGUIç•Œé¢
    tutorialGui.Parent = playerGui

    -- èƒŒæ™¯é®ç½©
    local overlay = Instance.new("Frame")
    overlay.Name = "Overlay"
    overlay.Size = UDim2.new(1, 0, 1, 0)
    overlay.Position = UDim2.new(0, 0, 0, 0)
    overlay.BackgroundColor3 = Color3.new(0, 0, 0)
    overlay.BackgroundTransparency = 0.5
    overlay.BorderSizePixel = 0
    overlay.Parent = tutorialGui

    -- ä¸»é¢æ¿
    local mainFrame = Instance.new("Frame")
    mainFrame.Name = "MainFrame"
    mainFrame.Size = UDim2.new(0, 500, 0, 350)
    mainFrame.Position = UDim2.new(0.5, -250, 0.5, -175)
    mainFrame.BackgroundColor3 = Color3.new(1, 1, 1)
    mainFrame.BorderSizePixel = 0
    mainFrame.Parent = overlay

    -- åœ†è§’
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 15)
    corner.Parent = mainFrame

    -- æ ‡é¢˜
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Name = "Title"
    titleLabel.Size = UDim2.new(1, -40, 0, 60)
    titleLabel.Position = UDim2.new(0, 20, 0, 20)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = tutorialSteps[1].title
    titleLabel.TextColor3 = Color3.new(0.2, 0.2, 0.2)
    titleLabel.TextScaled = true
    titleLabel.Font = Enum.Font.SourceSansBold
    titleLabel.Parent = mainFrame

    -- å†…å®¹
    local contentLabel = Instance.new("TextLabel")
    contentLabel.Name = "Content"
    contentLabel.Size = UDim2.new(1, -40, 0, 180)
    contentLabel.Position = UDim2.new(0, 20, 0, 90)
    contentLabel.BackgroundTransparency = 1
    contentLabel.Text = tutorialSteps[1].content
    contentLabel.TextColor3 = Color3.new(0.3, 0.3, 0.3)
    contentLabel.TextScaled = true
    contentLabel.Font = Enum.Font.SourceSans
    contentLabel.TextWrapped = true
    contentLabel.Parent = mainFrame

    -- æ­¥éª¤æŒ‡ç¤ºå™¨
    local stepFrame = Instance.new("Frame")
    stepFrame.Name = "StepIndicator"
    stepFrame.Size = UDim2.new(1, -40, 0, 30)
    stepFrame.Position = UDim2.new(0, 20, 0, 280)
    stepFrame.BackgroundTransparency = 1
    stepFrame.Parent = mainFrame

    local stepLayout = Instance.new("UIListLayout")
    stepLayout.FillDirection = Enum.FillDirection.Horizontal
    stepLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
    stepLayout.Padding = UDim.new(0, 10)
    stepLayout.Parent = stepFrame

    -- åˆ›å»ºæ­¥éª¤æŒ‡ç¤ºç‚¹
    for i = 1, #tutorialSteps do
        local dot = Instance.new("Frame")
        dot.Name = "Dot" .. i
        dot.Size = UDim2.new(0, 12, 0, 12)
        dot.BackgroundColor3 = i == 1 and Color3.new(0.2, 0.6, 1) or Color3.new(0.8, 0.8, 0.8)
        dot.BorderSizePixel = 0
        dot.Parent = stepFrame

        local dotCorner = Instance.new("UICorner")
        dotCorner.CornerRadius = UDim.new(0.5, 0)
        dotCorner.Parent = dot
    end

    -- æŒ‰é’®
    local nextButton = Instance.new("TextButton")
    nextButton.Name = "NextButton"
    nextButton.Size = UDim2.new(0, 120, 0, 40)
    nextButton.Position = UDim2.new(1, -140, 1, -60)
    nextButton.BackgroundColor3 = Color3.new(0.2, 0.6, 1)
    nextButton.BorderSizePixel = 0
    nextButton.Text = tutorialSteps[1].buttonText
    nextButton.TextColor3 = Color3.new(1, 1, 1)
    nextButton.TextScaled = true
    nextButton.Font = Enum.Font.SourceSansBold
    nextButton.Parent = mainFrame

    local buttonCorner = Instance.new("UICorner")
    buttonCorner.CornerRadius = UDim.new(0, 8)
    buttonCorner.Parent = nextButton

    -- å…³é—­æŒ‰é’®
    local closeButton = Instance.new("TextButton")
    closeButton.Name = "CloseButton"
    closeButton.Size = UDim2.new(0, 30, 0, 30)
    closeButton.Position = UDim2.new(1, -40, 0, 10)
    closeButton.BackgroundColor3 = Color3.new(0.9, 0.3, 0.3)
    closeButton.BorderSizePixel = 0
    closeButton.Text = "âœ•"
    closeButton.TextColor3 = Color3.new(1, 1, 1)
    closeButton.TextScaled = true
    closeButton.Font = Enum.Font.SourceSansBold
    closeButton.Parent = mainFrame

    local closeCorner = Instance.new("UICorner")
    closeCorner.CornerRadius = UDim.new(0, 15)
    closeCorner.Parent = closeButton

    -- æŒ‰é’®äº‹ä»¶
    nextButton.MouseButton1Click:Connect(function()
        nextStep()
    end)

    closeButton.MouseButton1Click:Connect(function()
        hideTutorial()
    end)

    -- åŠ¨ç”»æ•ˆæœ
    mainFrame.Size = UDim2.new(0, 0, 0, 0)
    mainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)

    local openTween = TweenService:Create(
        mainFrame,
        TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out),
        {
            Size = UDim2.new(0, 500, 0, 350),
            Position = UDim2.new(0.5, -250, 0.5, -175)
        }
    )
    openTween:Play()

    return mainFrame
end

-- æ›´æ–°æ•™ç¨‹å†…å®¹
local function updateTutorialContent()
    if not tutorialGui then return end

    local mainFrame = tutorialGui.Overlay.MainFrame
    local titleLabel = mainFrame.Title
    local contentLabel = mainFrame.Content
    local nextButton = mainFrame.NextButton
    local stepFrame = mainFrame.StepIndicator

    -- æ›´æ–°å†…å®¹
    titleLabel.Text = tutorialSteps[currentStep].title
    contentLabel.Text = tutorialSteps[currentStep].content
    nextButton.Text = tutorialSteps[currentStep].buttonText

    -- æ›´æ–°æ­¥éª¤æŒ‡ç¤ºå™¨
    for i = 1, #tutorialSteps do
        local dot = stepFrame:FindFirstChild("Dot" .. i)
        if dot then
            dot.BackgroundColor3 = i == currentStep and Color3.new(0.2, 0.6, 1) or Color3.new(0.8, 0.8, 0.8)
        end
    end
end

-- ä¸‹ä¸€æ­¥
function nextStep()
    currentStep = currentStep + 1

    if currentStep > #tutorialSteps then
        hideTutorial()
    else
        updateTutorialContent()
    end
end

-- æ˜¾ç¤ºæ•™ç¨‹
function TutorialUI.showTutorial()
    if isShowing then return end

    isShowing = true
    currentStep = 1
    createTutorialGUI()
end

-- éšè—æ•™ç¨‹
function hideTutorial()
    if not isShowing or not tutorialGui then return end

    local mainFrame = tutorialGui.Overlay.MainFrame

    local closeTween = TweenService:Create(
        mainFrame,
        TweenInfo.new(0.2, Enum.EasingStyle.Back, Enum.EasingDirection.In),
        {
            Size = UDim2.new(0, 0, 0, 0),
            Position = UDim2.new(0.5, 0, 0.5, 0)
        }
    )

    closeTween:Play()
    closeTween.Completed:Connect(function()
        if tutorialGui then
            tutorialGui:Destroy()
            tutorialGui = nil
        end
        isShowing = false
    end)
end

-- éšè—æ•™ç¨‹ï¼ˆå…¬å…±æ¥å£ï¼‰
function TutorialUI.hideTutorial()
    hideTutorial()
end

-- æ£€æŸ¥æ˜¯å¦æ­£åœ¨æ˜¾ç¤º
function TutorialUI.isShowing()
    return isShowing
end

-- åˆå§‹åŒ–
function TutorialUI.initialize()
    -- å»¶è¿Ÿ3ç§’æ˜¾ç¤ºæ•™ç¨‹ï¼Œç»™ç©å®¶ä¸€äº›æ—¶é—´é€‚åº”
    spawn(function()
        wait(3)
        TutorialUI.showTutorial()
    end)
end

return TutorialUI
